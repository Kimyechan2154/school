# 부채널 분석

암호 알고리즘 동작시 발생하는 부채널 정보를 활용해 비밀키 찾는 법

- 비침입 공격 - 암호 알고리즘 동작 시 발생하는 부가적인 정보(소비전력, 전자파 방출 소리 계측)를 수집 분석해 비밀 정보 획득 
- 준 침입 공격 - 암호 알고리즘 동작 시 오류를 주입해 변경된 출력 값과 부가적인 정보 (레이저 주입 전자파 주입)를 수집 분석해 비밀 정보 획득

### 비침임 공격
1. SPA - 암호 알고리즘 동작하는 동안에 수집된 파형 분석(눈으로 관찰)
2. DPA - 암호 알고리즘 동작하는 동안에 수집된 파형의 **평균의 차**를 이용
3. CPA - 암호 알고리즘 동작하는 동안에 수집된 파형의 **상관관계**를 이용


Gemini의 응답
1. 부채널 분석 및 SPA (단순 전력 분석) 상세 설명

부채널 분석(Side-Channel Analysis)의 개념
암호 알고리즘의 수학적 취약점을 공격하는 것이 아니라, 암호 기기(스마트카드, IoT 기기 등)가 실제로 연산을 수행할 때 기기 밖으로 새어 나오는 '물리적인 부가 정보'를 이용해 비밀키를 찾아내는 기법입니다. 여기서 활용되는 정보가 바로 전력 소비량, 전자파, 연산 시간 등입니다.

비침입적(Non-invasive) 방식
칩의 겉면을 벗겨내거나 내부 회로를 직접 훼손하는 방식(침입형)과 다릅니다. 기기를 정상 작동시키면서 외부 전력선에 오실로스코프를 연결하거나, 칩 근처에 프로브를 대어 전자파를 측정합니다. 기기를 파괴하지 않기 때문에 공격 흔적이 남지 않습니다.

SPA (Simple Power Analysis, 단순 전력 분석)
측정된 전력 또는 전자파 파형(Trace)을 '눈으로 직접 관찰하여' 직관적으로 분석하는 가장 기본적인 전력 분석 공격입니다.

원리: 암호 알고리즘 내부에는 조건 분기문(if문 등)이 존재합니다. 데이터 비트가 0일 때와 1일 때 기기가 수행하는 명령어의 종류나 연산 시간이 달라집니다. (대표적으로 RSA의 Square and Multiply 알고리즘 연산).

분석: 연산의 종류가 다르면 전력을 소비하는 패턴(파형의 높낮이, 폭, 피크의 형태)도 명확하게 달라집니다. 분석자는 수집된 파형을 시각적으로 확인하여 특정 구간에서 어떤 연산이 일어났는지 추론하고, 이를 통해 비밀키의 비트 배열을 그대로 읽어냅니다.

2. 전력 소비 모델 (HW 및 HD) 상세 설명

부채널 공격(특히 차분 전력 분석 등)을 수행하려면, 암호 기기 내부에서 처리되는 '데이터의 값'과 실제 측정된 '전력 소비량' 사이의 상관관계를 통계적으로 연결해 줄 기준이 필요합니다. 이때 주로 사용하는 두 가지 전력 소비 모델이 HW와 HD입니다.

HW (Hamming Weight, 해밍 웨이트)

정의: 어떤 데이터의 이진(Binary) 표현에서 '1'의 개수를 의미합니다.

전력 소비와의 관계: 주로 마이크로컨트롤러의 데이터 버스나 레지스터가 0으로 초기화(Pre-charge)되어 있는 상태에서 새로운 데이터가 기록될 때 유용한 모델입니다. 데이터에 '1'이 많을수록 기기가 해당 비트들을 활성화하기 위해 더 많은 전력을 소비한다고 가정합니다.

예시: 데이터가 10110011이라면 1의 개수가 5개이므로 HW는 5입니다. 반면 00000010은 HW가 1입니다. 이 모델에 따르면 전자의 연산이 후자보다 더 높은 전력 파형을 그립니다.

HD (Hamming Distance, 해밍 디스턴스)

정의: 기기 내부의 레지스터 상태가 이전 상태(Data A)에서 새로운 상태(Data B)로 변환될 때, 상태가 변경되는(플립되는) 비트의 개수를 의미합니다.

전력 소비와의 관계: 대부분의 현대 스마트카드 및 칩은 CMOS 회로로 구성되어 있습니다. CMOS 회로는 상태가 유지될 때보다 0에서 1로, 또는 1에서 0으로 상태가 전이(Transition)될 때 전력을 크게 소비합니다. 따라서 실제 칩의 전력 소비량은 단순히 1의 개수(HW)보다는 상태 변환 횟수(HD)에 더 비례하는 경우가 많습니다.

계산 방식: 이전 데이터와 현재 데이터를 XOR 연산한 결과의 HW를 구하면 HD가 됩니다. (예: 0101에서 0110으로 변했다면 끝의 두 비트가 변경되었으므로 HD는 2입니다.)

4. DPA (차분 전력 분석)의 기본 원리 상세 설명

DPA (Differential Power Analysis)란?
SPA가 전력 파형을 눈으로 직접 보고 분석하는 방식이라면, DPA는 눈에 띄지 않는 아주 미세한 전력 소비량의 차이를 **통계적인 방법(평균의 차 등)**을 이용해 증폭시켜 분석하는 훨씬 강력한 공격 기법입니다. 잡음(Noise)이 많은 환경에서도 비밀키를 찾아낼 수 있습니다.

1라운드를 타겟으로 하는 이유
AES나 DES 같은 블록 암호 알고리즘은 데이터를 섞는 과정(라운드)을 여러 번 반복합니다.

공격자는 기기에 입력되는 평문(Plaintext)과 출력되는 암호문(Ciphertext)은 알 수 있지만, 기기 내부에서 연산 중인 중간 데이터는 알 수 없습니다.

따라서 공격자가 알고 있는 평문과 비밀키(Key)의 일부가 최초로 결합하여 연산되는 1라운드(또는 암호문과 결합하는 마지막 라운드)를 공격 목표로 잡아야 예측과 계산이 가능하기 때문입니다.

중간값 선택 및 전력 소비 측정

중간값(Intermediate Value): 알고 있는 평문의 일부 데이터와 '공격자가 임의로 추측한 8비트 정도의 짧은 키(Guess Key)'를 연산하여 나온 특정 시점의 결과값(예: S-Box를 통과한 직후의 값)을 타겟으로 선택합니다.

기기에 동일한 비밀키를 둔 상태로 수천에서 수만 개의 무작위 평문을 입력하여 암호화를 반복 수행하고, 그때마다 발생하는 전력 소비 파형(Trace)을 오실로스코프 등으로 전부 수집합니다.

통계적 분석과 평균의 차
수집된 수많은 파형을 바탕으로, 우리가 추측한 키가 진짜 키라고 가정했을 때 연산되는 '중간값'을 앞서 배운 전력 소비 모델(HW 등)과 연결하여 분석합니다. 올바른 키를 추측했을 때만 통계적으로 유의미한 전력 파형의 특징이 나타나게 되며, 이를 통해 비밀키의 조각들을 하나씩 찾아냅니다.
